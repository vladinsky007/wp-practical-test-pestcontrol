/*! For license information please see index.js.LICENSE.txt */
(()=>{var e={500:(e,t)=>{var n;!function(){"use strict";var o={}.hasOwnProperty;function a(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=c(e,r(n)))}return e}function r(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return a.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)o.call(e,n)&&e[n]&&(t=c(t,n));return t}function c(e,t){return t?e?e+" "+t:e+t:e}e.exports?(a.default=a,e.exports=a):void 0===(n=function(){return a}.apply(t,[]))||(e.exports=n)}()}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=window.wp.hooks;function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},t.apply(this,arguments)}const o=window.wp.element,a=window.wp.i18n,r=window.wp.blockEditor,c=window.wp.data,i=window.wp.compose,s=window.wp.components,l=["core/paragraph","core/heading","core/code","core/preformatted","core/verse"];var p=n(500),d=n.n(p);const m=window.aicp["api-action-templates"],u=window.aicp.icons;function g({executeAction:e=(()=>{})}){const{actions:t,hasActions:n}=(0,m.useApiActionTemplates)(),r=(t,n)=>o=>{o.preventDefault(),n(),e(t)};return(0,o.createElement)(s.DropdownMenu,{icon:u.Copilot,label:(0,a.__)("Actions","ai-copilot"),className:d()("block-editor-block-settings-menu","components-toolbar"),noIcons:!0},(({onClose:e})=>(0,o.createElement)(o.Fragment,null,!n&&(0,o.createElement)(s.MenuItem,{key:"none",iconPosition:"left",info:(0,a.__)("There are no actions for this post type.","ai-copilot"),onClick:t=>{e()}},(0,a.__)("Actions","ai-copilot")),n&&t.map(((t,n)=>(0,o.createElement)(o.Fragment,null,(0,o.createElement)(s.MenuGroup,null,(0,o.createElement)(s.MenuItem,{key:t.action_id,iconPosition:"left",info:t.action_description,onClick:r(t,e)},t.action_label))))))))}const _=window.aicp.components,f=window.aicp["api-services"],E=window.aicp.helpers,w=window.wp.notices,b=({imageAction:e,images:t,setImageAction:n,isLoading:r,setIsLoading:c,generateImage:i,insertGeneratedImage:l,setIsModalOpen:p})=>{const{Fill:d}=(0,_.useModalSlotContext)(),[m,u]=(0,o.useState)("");return(0,o.createElement)(o.Fragment,null,(0,o.createElement)(d.Header,null,(0,o.createElement)("h1",null,(0,a.__)("Generate Image","ai-copilot"))),(0,o.createElement)(d.Content,null,(0,o.createElement)("div",{className:"aicp__modal__flex"},(0,o.createElement)("div",{className:"aicp__modal__flex__column0"},(0,o.createElement)(_.CarouselImages,{images:t.map((e=>e.src)),onChange:u})))),(0,o.createElement)(d.Sidebar,null,(0,o.createElement)(s.Panel,null,(0,o.createElement)(s.PanelBody,{className:"aicp__panels_panel",title:(0,a.__)("Prompt","ai-copilot"),initialOpen:!0},(0,o.createElement)(s.TextareaControl,{label:(0,a.__)("Keywords:","ai-copilot"),help:(0,a.__)("Keywords to generate images.","ai-copilot"),onChange:t=>{n({...e,image_keywords:t})},value:e.image_keywords})),(0,o.createElement)(_.ImagePanel,{values:e,onChange:n}),(0,o.createElement)(_.ImageInsertPanel,{values:e,onChange:n}))),(0,o.createElement)(d.FooterLeft,null,(0,o.createElement)("button",{type:"submit",className:"button button-secondary",disabled:r,onClick:e=>{e.preventDefault(),i()}},(0,a.__)("Generate","ai-copilot")),(0,o.createElement)("button",{type:"submit",className:"button button-primary",disabled:r||0===t.length,onClick:n=>{n.preventDefault(),c(!0);const{caption:o="",base64:a=""}=t.find((e=>e.src===m));l(m,c,e.image_position,p,o,a)}},(0,a.__)("Save","ai-copilot")),r&&(0,o.createElement)(_.Spinner,null)))};function y({label:e=(0,a.__)("Image","ai-copilot"),insertGeneratedImage:t,contentKeywords:n,isModalOpen:r,onOpen:i,onClose:l}){const[p,d]=(0,o.useState)(!1),[m,g]=(0,o.useState)([]),[y,I]=(0,o.useState)({...E.DEFAULT_CONFIG_IMAGE}),h="pexels"===y.image_source?E.OPTIONS_IMAGE_SIZE_PEXELS:E.OPTIONS_IMAGE_SIZE_OPEN_AI;return(0,o.useEffect)((()=>{I({...y,image_size:h[0].value})}),[y.image_source]),(0,o.useEffect)((()=>{I({...y,image_keywords:n})}),[n]),(0,o.createElement)(s.ToolbarGroup,null,(0,o.createElement)(s.ToolbarButton,{icon:u.ImageDraw,label:e,onClick:i}),r&&(0,o.createElement)(_.Modal,{onClose:l,show:r,className:"aicp__modal--actions-image"},(0,o.createElement)(b,{imageAction:y,setImageAction:I,images:m,isLoading:p,setIsLoading:d,isModalOpen:r,generateImage:async()=>{try{d(!0);const{response:e}=await(0,f.fetchServicesImage)({...y,prompt:y.image_keywords,image_model:"pexels"===y.image_source?"pexels":"dall-e-3"});if(d(!1),!e)return;g(e)}catch(t){console.error(t),e=t,(0,c.dispatch)(w.store).createSuccessNotice((0,a.sprintf)("%s",e.message),{type:"snackbar"})}var e},insertGeneratedImage:t,setIsModalOpen:l})))}const I=window.wp.blocks,h=(k=g,e=>{const{name:n,clientId:i,attributes:s,setAttributes:p,isMultiBlockSelection:d,selectedBlocks:m}=e,{updateBlockAttributes:u,removeBlocks:g,insertBlocks:_}=(0,c.useDispatch)(r.store),b=(0,c.useSelect)((e=>{const{getBlockIndex:t}=e("core/block-editor");return t})),y=async(e,t)=>{try{const{response:n}=await(0,f.fetchServicesTextOpenAi)({model:e.model,max_tokens:e.model_max_tokens,temperature:e.model_temperature,prompt_system:e.prompt_system,prompt_user:t,consumer_module:"actions"});return n.trim()}catch(e){return(e=>{(0,c.dispatch)(w.store).createSuccessNotice(sprintf("%s",e.message),{type:"snackbar"})})(e),null}},h=e=>u(e,{content:(0,a.__)("Loading…","ai-copilot")}),C={executeAction:async e=>{const{variables_language:t,variables_style:o,variables_tone:a,action_type:r}=e,c={LANGUAGE:t,STYLE:o,TONE:a};if(m.length>0)if("replace"===r){m.forEach((e=>h(e.clientId)));for(let t=0;t<m.length;t++){const n=m[t];c.CONTENT=n.attributes.content;const o=(0,E.generatePrompt)(e.prompt_user,c),a=await y(e,o)||n.attributes.content;u(n.clientId,{content:a})}}else{const{name:t,clientId:n}="prepend"===r?m[0]:m[m.length-1],o="prepend"===r?b(n):b(n)+1,a=(0,I.createBlock)(l[0]);_(a,o),h(a.clientId),c.CONTENT=m.map((e=>e.attributes.content)).join("\n\n");const i=(0,E.generatePrompt)(e.prompt_user,c),s=await y(e,i);if(s){const e=(0,I.createBlock)(t,{content:s});_(e,o)}g(a.clientId)}else{const{content:t}=s;let o,a;"replace"===r?h(i):(o="prepend"===r?b(i):b(i)+1,a=(0,I.createBlock)(l[0]),_(a,o),h(a.clientId)),c.CONTENT=t;const d=(0,E.generatePrompt)(e.prompt_user,c),m=await y(e,d);if(m)if("replace"===r)p({content:m});else{const e=(0,I.createBlock)(n,{content:m});_(e,o),g(a.clientId)}else p({content:t})}}};return(0,o.createElement)(k,t({},e,C))});var k;const C=(e=>n=>{const[a,i]=(0,o.useState)(!1),[s,l]=(0,o.useState)(""),{content:p,clientId:d}=n,{insertBlocks:m}=(0,c.useDispatch)(r.store),u=(0,c.useSelect)((e=>{const{getBlockIndex:t}=e("core/block-editor");return t})),g={insertGeneratedImage:async(e,t,n,o,a="",r="")=>{const c={url:e,post_id:0,caption:a,base64:r},{image_url:i}=await(0,f.fetchRestApiImageUpload)({data:c}),s=(0,I.createBlock)("core/image",{url:i,align:n,caption:a}),l=u(d)+1;t(!1),o(!1),m(s,l)},contentKeywords:s,isModalOpen:a,onOpen:()=>{i(!0),l((()=>{const e=wp.data.select("core/block-editor").getSelectionStart().offset,t=wp.data.select("core/block-editor").getSelectionEnd().offset,n=e===t?p:p.slice(e,t),o=(0,E.getTextLanguage)(n).toLowerCase();return(0,E.getTextKeywords)(n,o).join(" ")})())},onClose:()=>i(!1)};return(0,o.createElement)(e,t({},n,g))})(y),v=(0,i.createHigherOrderComponent)((e=>n=>{const{name:i,clientId:p,isSelected:d,attributes:m,setAttributes:u,toggleProps:g={describedBy:(0,a.__)("AI Copilot Actions","ai-copilot")}}=n,_=(0,c.useSelect)((e=>{const{getSelectedBlockClientIds:t,getBlock:n}=e("core/block-editor");return t().map((e=>n(e)))}));return _.length>1&&l.includes(_[0]?.name)||l.includes(i)&&d?(0,o.createElement)(o.Fragment,null,(0,o.createElement)(e,n),(0,o.createElement)(r.BlockControls,null,(0,o.createElement)(s.ToolbarItem,g,(e=>(0,o.createElement)(h,t({},e,n,{selectedBlocks:_})))),(0,o.createElement)(s.ToolbarItem,g,(e=>(0,o.createElement)(C,t({},e,{content:m.content,clientId:p})))))):(0,o.createElement)(e,n)}),"addOptionsToParagraphToolbar");(0,e.addFilter)("editor.BlockEdit","ai-copilot/add-options-to-paragraph",v);const S=(e=>n=>{const{editor:r}=n,i={executeAction:async e=>{r.setMode("readonly");const{variables_language:t,variables_style:n,variables_tone:o,action_type:i}=e,s=r.selection.isCollapsed()?r.getContent():r.selection.getContent(),l={LANGUAGE:t,STYLE:n,TONE:o,CONTENT:s},p=(0,E.generatePrompt)(e.prompt_user,l),d=(0,a.__)("Loading…","ai-copilot"),m="replace"===i?"span":"p",u=sprintf(`<${m} id="aicp-loading-action"> --%s-- </${m}>`,d);let g;"prepend"===i&&(g=u+s),"append"===i&&(g=s+u),"replace"===i&&(g=u),r.selection.isCollapsed()?r.setContent(g):r.selection.setContent(g);const _=r.dom.select(`${m}[id="aicp-loading-action"]`)[0];r.selection.select(_);try{const{response:t}=await(0,f.fetchServicesTextOpenAi)({model:e.model,max_tokens:e.model_max_tokens,temperature:e.model_temperature,prompt_system:e.prompt_system,prompt_user:p,consumer_module:"actions"}),n="replace"===i?t.trim():`<p>${t.trim()}</p>`;r.selection.setContent(n)}catch(e){(0,c.dispatch)(w.store).createSuccessNotice(sprintf("%s",e.message),{type:"snackbar"}),r.selection.setContent(s)}r.setMode("design")}};return(0,o.createElement)(e,t({},n,i))})(g),A=(e=>n=>{const{editor:a}=n,[r,c]=(0,o.useState)("");(0,o.useEffect)((()=>{const e=setInterval((()=>{if(a&&a.initialized){c(a.getContent());const t=()=>{c(a.selection.getContent()||a.getContent())};return a.on("NodeChange",t),clearInterval(e),()=>{a.off("NodeChange",t)}}}),100);return()=>{clearInterval(e)}}),[a]);const i=(0,E.getTextKeywords)(r,(0,E.getTextLanguage)(r).toLowerCase())?.join(" "),s={className:"classic-editor",insertGeneratedImage:async(e,t,n,o,r="",c="")=>{a.setMode("readonly");const i={url:e,post_id:0,caption:r,base64:c},{image_url:s,image_id:l}=await(0,f.fetchRestApiImageUpload)({data:i});let p;p=r?(0,E.getCaptionImageHTML)({image_id:l,image_url:s,position:n,caption:r}):`<img src="${s}" alt="" class="align${n}" />`;const d=`${a.selection.getContent()}<br>${p}`;a.insertContent(d),a.setMode("design"),t(!1),o(!1)},contentKeywords:i};return(0,o.createElement)(e,t({},n,s))})(y);(0,E.onDocumentLoaded)((()=>{const e=window?.tinymce;e&&(e.PluginManager.add("aicp-ai-copilot",(function(e,t){e.addButton("aicp-ai-copilot",{type:"button",text:"AI Copilot",icon:!1,onPostRender(){(0,o.render)((0,o.createElement)(S,{editor:e}),this.getEl())}})})),e.PluginManager.add("aicp-image-generator",(function(e,t){e.addButton("aicp-image-generator",{type:"button",text:"Image Generator",icon:!1,onPostRender(){(0,o.render)((0,o.createElement)(A,{editor:e}),this.getEl())}})})))}))})()})();