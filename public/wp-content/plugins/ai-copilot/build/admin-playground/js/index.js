/*! For license information please see index.js.LICENSE.txt */
(()=>{var e={500:(e,t)=>{var a;!function(){"use strict";var n={}.hasOwnProperty;function l(){for(var e="",t=0;t<arguments.length;t++){var a=arguments[t];a&&(e=o(e,s(a)))}return e}function s(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return l.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var a in e)n.call(e,a)&&e[a]&&(t=o(t,a));return t}function o(e,t){return t?e?e+" "+t:e+t:e}e.exports?(l.default=l,e.exports=l):void 0===(a=function(){return l}.apply(t,[]))||(e.exports=a)}()}},t={};function a(n){var l=t[n];if(void 0!==l)return l.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,a),s.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=window.wp.element,t=window.aicp.helpers,n=window.aicp.components,l=window.wp.i18n,s=(0,e.createContext)({}),o=()=>(0,e.useContext)(s),r=(e,t)=>{switch(t.type){case"SET_IS_MODAL_OPEN":case"SET_PLAYGROUND_TAB":case"SET_PLAYGROUND_ERROR":case"SET_PLAYGROUND_COMPLETION":case"SET_PLAYGROUND_CHAT":case"SET_PLAYGROUND_ASSISTANT":case"SET_PLAYGROUND_IMAGE":return{...e,...t.payload}}return e},i=({children:a})=>{const[o,i]=(0,e.useReducer)(r,{isModalOpen:!1,playgroundTab:"chat",playgroundError:"",playgroundCompletion:{model:"gpt-3.5-turbo-instruct",model_temperature:1,model_max_tokens:256,model_top_p:1,model_frequency_penalty:0,model_presence_penalty:0,model_stop:"",model_best_of:1,prompt:""},playgroundChat:{model:"gpt-3.5-turbo",model_temperature:1,model_max_tokens:256,model_top_p:1,model_frequency_penalty:0,model_presence_penalty:0,model_stop:"",messages:[]},playgroundAssistant:{model:"gpt-3.5-turbo",assistant_id:-1,assistant_description:(0,l.__)("Select Assistant","ai-copilot"),assistant_label:(0,l.__)("Select Assistant","ai-copilot"),tools:[{type:"retrieval"}],tools_file_ids:[],content:[],thread_openai_id:""},playgroundImage:{...t.DEFAULT_CONFIG_IMAGE,images:[]}}),c=[{title:(0,l.__)("Complete","ai-copilot"),name:"completion"},{title:(0,l.__)("Chat","ai-copilot"),name:"chat"},{title:(0,e.createElement)(e.Fragment,null,(0,l.__)("Assistant","ai-copilot"),(0,e.createElement)(n.Badge,null,"Soon")),name:"assistant"},{title:(0,l.__)("Image","ai-copilot"),name:"image"}];return(0,e.createElement)(s.Provider,{value:{...o,TABS:c,setIsModalOpen:e=>{o.isModalOpen!==e&&i({type:"SET_IS_MODAL_OPEN",payload:{isModalOpen:e}})},setPlaygroundCompletion:e=>{const a=(0,t.deepMerge)(o.playgroundCompletion,e);i({type:"SET_PLAYGROUND_COMPLETION",payload:{playgroundCompletion:void 0===a?"":a}})},setPlaygroundChat:e=>{const a=(0,t.deepMerge)(o.playgroundChat,e);i({type:"SET_PLAYGROUND_CHAT",payload:{playgroundChat:void 0===a?"":a}})},setPlaygroundAssistant:e=>{const a=(0,t.deepMerge)(o.playgroundAssistant,e);i({type:"SET_PLAYGROUND_ASSISTANT",payload:{playgroundAssistant:void 0===a?"":a}})},setPlaygroundImage:e=>{const a=(0,t.deepMerge)(o.playgroundImage,e);i({type:"SET_PLAYGROUND_IMAGE",payload:{playgroundImage:void 0===a?"":a}})},setPlaygroundTab:e=>{i({type:"SET_PLAYGROUND_TAB",payload:{playgroundTab:e}})},setPlaygroundError:e=>{const t=e||(0,l.__)("An unexpected error occurred","ai-copilot");console.error(t),i({type:"SET_PLAYGROUND_ERROR",payload:{playgroundError:t}}),alert(t)}}},a)},c=(s.Consumer,window.aicp["api-admin-menu"]);var m=a(500),_=a.n(m);const d=window.wp.components,p=window.aicp["api-assistants"];function u(){const{Fill:t}=(0,n.useModalSlotContext)(),{playgroundTab:a,setPlaygroundTab:s,TABS:r}=o(),i=e=>t=>{t.preventDefault(),s(e)};return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(t.Header,null,(0,e.createElement)("h1",null,(0,l.__)("Playground","ai-copilot"))),(0,e.createElement)(t.Navigation,null,r.map((t=>{const{name:n,title:l}=t;return(0,e.createElement)("a",{key:n,href:"#",className:_()("media-menu-item","assistant"===n&&"aicp__disabled",a===n&&"active"),onClick:i(n)},l)}))))}function g({children:t,className:a}){const{Fill:l}=(0,n.useModalSlotContext)();return(0,e.createElement)(l.Sidebar,null,(0,e.createElement)(d.Panel,{className:a},t))}window.aicp["api-assistant-threads"],window.aicp["api-assistant-messages"];const E=({isLoading:t,handleSubmit:a,isDisabled:s,children:o})=>{const{Fill:r}=(0,n.useModalSlotContext)();return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(r.FooterLeft,null,(0,e.createElement)(e.Fragment,null,(0,e.createElement)("form",{className:"aicp__playground__modal-footer",onSubmit:a},(0,e.createElement)("div",{className:"aicp__playground__modal-footer__button-container"},(0,e.createElement)("button",{type:"submit",className:"button button-primary aicp__playground__modal-footer__submit",disabled:t||s},(0,l.__)("Submit","ai-copilot")),t&&(0,e.createElement)(n.Spinner,null))),o)),(0,e.createElement)(r.FooterRight,null,(0,e.createElement)(n.TransactionsFormTable,null)))},y=()=>{const{playgroundAssistant:t}=o();return(0,e.createElement)("div",{className:"aicp__playground__modal-message-list"},t.content.map(((a,n)=>(0,e.createElement)("div",{key:n,className:"aicp__playground__modal-message-list__message"},(0,e.createElement)("h4",null,(0,e.createElement)("span",{className:"aicp__playground__modal-message-list__role-text"},"user"==a.role?(0,l.__)("USER","ai-copilot"):t.assistant_label)),(0,e.createElement)("div",{className:"aicp__playground__modal-message-list__text-input-focus"},(0,e.createElement)("p",null,a.content))))))},v=()=>{const{Fill:t}=(0,n.useModalSlotContext)(),{playgroundAssistant:a,setPlaygroundAssistant:s,setPlaygroundError:r}=o(),[i,c]=(0,e.useState)(!1),[m,_]=(0,e.useState)(""),{assistants:v,createAssistant:h,syncAssistants:f}=(0,p.useApiAssistant)(),S=!v.find(((e,t)=>e.assistant_id===a.assistant_id||0===t))||!m;return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(u,null),(0,e.createElement)(t.Content,null,(0,e.createElement)("div",{className:"aicp__modal__flex aicp__disabled"},(0,e.createElement)("div",{className:"aicp__modal__flex__column1"},(0,e.createElement)(d.TextareaControl,{key:"assistant",className:"aicp__playground__modal__textarea",label:(0,l.__)("Instructions","ai-copilot"),placeholder:(0,l.__)("You are a helpful assistant.","ai-copilot"),value:m})),(0,e.createElement)("div",{className:"aicp__modal__flex__column2"},(0,e.createElement)("div",null,(0,e.createElement)(y,null)),(0,e.createElement)("div",null,(0,e.createElement)(d.TextareaControl,{className:"aicp__playground__modal__textarea",label:(0,l.__)("Message","ai-copilot"),placeholder:(0,l.__)("Enter your messageâ€¦","ai-copilot"),value:m}))))),(0,e.createElement)(g,{className:"aicp__disabled"},(0,e.createElement)(n.AssistantTemplateSearchPanel,{initialOpen:!0,values:a,onChange:e=>{(e=>{s({assistant_id:e.assistant_id})})(e)}}),(0,e.createElement)(n.ContentModelPanel,{initialOpen:!0,mode:"chat",values:a,onChange:s})),(0,e.createElement)(E,{isLoading:i,isDisabled:S}))},h=window.aicp["api-services"],f=window.aicp.icons,S=()=>{const{playgroundChat:t,setPlaygroundChat:a}=o(),n=(0,e.useRef)([]),s=e=>{const t=e.current;t&&(t.style.height=`${t.scrollHeight}px`)};return(0,e.useEffect)((()=>{(async()=>{n.current.forEach((e=>{s(e)}))})()}),[t]),(0,e.createElement)("div",{className:"aicp__playground__modal-message"},t.messages.map(((o,r)=>"system"===o.role?null:(n.current[r]||(n.current[r]=(0,e.createRef)()),(0,e.createElement)("div",{key:r,className:"aicp__playground__modal-message__message"},(0,e.createElement)("h4",{onClick:()=>(e=>{const n=[...t.messages];n[e].role="user"===n[e].role?"assistant":"user",a({...t,messages:n})})(r)},(0,e.createElement)("span",{className:"aicp__playground__modal-message__role-text"},"user"==t.messages[r]?.role?(0,l.__)("USER","ai-copilot"):(0,l.__)("ASSISTANT","ai-copilot"))),(0,e.createElement)("div",{className:"aicp__playground__modal-message__text-input-focus"},(0,e.createElement)("textarea",{ref:n.current[r],rows:"1",tabIndex:"0",value:t.messages[r]?.content||"",onChange:e=>{((e,n)=>{const l=[...t.messages];l[n]?l[n].content=e:l.push({role:n%2==1?"USER":"ASSISTANT",content:e}),a({...t,messages:l})})(e.target.value,r),s(n.current[r])},placeholder:"user"==t.messages[r]?.role?(0,l.__)("Enter a user message here.","ai-copilot"):(0,l.__)("Enter an assistant message here.","ai-copilot")})),(0,e.createElement)("div",{className:"aicp__playground__modal-message__button-container",onClick:()=>(e=>{const n=[...t.messages];n.splice(e,1),a({...t,messages:n})})(r)},(0,e.createElement)(f.Remove,null)))))),(0,e.createElement)("div",{className:"aicp__playground__modal-message__message aicp__playground__modal-message__add-message",onClick:()=>{const e=t.messages.filter((e=>"system"!==e.role)),n=e.length%2==1?"assistant":"user";a({...t,messages:[...t.messages,{role:n,content:""}]})}},(0,e.createElement)(f.AddMore,null),(0,e.createElement)("h4",null,(0,e.createElement)("span",null,(0,l.__)("Add message","ai-copilot")))))},b=()=>{const{Fill:t}=(0,n.useModalSlotContext)(),{playgroundChat:a,setPlaygroundChat:s,setPlaygroundError:r}=o(),{setTransactionsForm:i}=(0,n.useTransactionsFormProvider)(),[c,m]=(0,e.useState)(!1);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(u,null),(0,e.createElement)(t.Content,null,(0,e.createElement)("div",{className:"aicp__modal__flex"},(0,e.createElement)("div",{className:"aicp__modal__flex__column1"},(0,e.createElement)(d.TextareaControl,{key:"chat",className:"aicp__playground__modal__textarea",label:(0,l.__)("System","ai-copilot"),placeholder:(0,l.__)("You are a helpful assistant.","ai-copilot"),value:a.messages.find((e=>"system"===e.role&&e.content))?.content,onChange:e=>(e=>{let t=[...a.messages];t=t.filter((e=>"system"!==e.role)),t.push({role:"system",content:e}),s({messages:t})})(e)})),(0,e.createElement)("div",{className:"aicp__modal__flex__column2"},(0,e.createElement)(S,null)))),(0,e.createElement)(g,null,(0,e.createElement)(n.ContentModelPanel,{initialOpen:!0,mode:"chat",values:a,onChange:s})),(0,e.createElement)(E,{isLoading:c,handleSubmit:async e=>{e.preventDefault(),m(!0);try{const{response:e,transaction:t}=await(0,h.fetchServicesTextOpenAi)({model:a.model,max_tokens:a.model_max_tokens,temperature:a.model_temperature,messages:a.messages,consumer_module:"playground"});if(m(!1),t&&i(t),!e)return!1;(e=>{s({messages:[...a.messages,{role:"assistant",content:e}]})})(e)}catch(e){r(e)}},isDisabled:!a.messages[0]?.content&&!a.messages[1]?.content}))},C=()=>{const{Fill:t}=(0,n.useModalSlotContext)(),{playgroundCompletion:a,setPlaygroundCompletion:s,setPlaygroundError:r}=o(),{setTransactionsForm:i}=(0,n.useTransactionsFormProvider)(),[c,m]=(0,e.useState)(!1);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(u,null),(0,e.createElement)(t.Content,null,(0,e.createElement)("div",{className:"aicp__modal__flex"},(0,e.createElement)("div",{className:"aicp__modal__flex__column0"},(0,e.createElement)(d.TextareaControl,{key:"completion",className:"aicp__playground__modal__textarea",placeholder:(0,l.__)("Write a tagline for an ice cream shop.","ai-copilot"),value:a.prompt,onChange:e=>(e=>{s({prompt:e})})(e)})))),(0,e.createElement)(g,null,(0,e.createElement)(n.ContentModelPanel,{initialOpen:!0,mode:"completion",values:a,onChange:s})),(0,e.createElement)(E,{isLoading:c,handleSubmit:async e=>{e.preventDefault(),m(!0);try{const{response:e,transaction:t}=await(0,h.fetchServicesTextOpenAi)({model:a.model,max_tokens:a.model_max_tokens,temperature:a.model_temperature,prompt:a.prompt,consumer_module:"playground"});if(m(!1),t&&i(t),!e)return!1;(e=>{s({prompt:a.prompt?a.prompt+"\n"+e:e})})(e)}catch(e){r(e)}},isDisabled:!a.prompt}))},A=()=>{const{Fill:t}=(0,n.useModalSlotContext)(),{playgroundImage:a,setPlaygroundImage:s,setPlaygroundError:r}=o(),{setTransactionsForm:i}=(0,n.useTransactionsFormProvider)(),[c,m]=(0,e.useState)(""),[_,p]=(0,e.useState)(!1),[y,v]=(0,e.useState)(!1),f=a.images.map((e=>e.src));return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(u,null),(0,e.createElement)(t.Content,null,(0,e.createElement)("div",{className:"aicp__modal__flex"},(0,e.createElement)("div",{className:"aicp__modal__flex__column1"},(0,e.createElement)(d.TextareaControl,{key:"image",className:"aicp__playground__modal__textarea",required:!0,label:(0,l.__)("Instructions","ai-copilot"),placeholder:(0,l.__)('Insert your prompt. For example: "A photo of a cat with a hat."',"ai-copilot"),value:a.image_prompt,onChange:e=>(e=>s({image_prompt:e}))(e)})),(0,e.createElement)("div",{className:"aicp__modal__flex__column2"},(0,e.createElement)(n.CarouselImages,{images:f,onChange:m})))),(0,e.createElement)(g,null,(0,e.createElement)(n.ImagePanel,{initialOpen:!0,values:a,onChange:s})),(0,e.createElement)(E,{isLoading:_,handleSubmit:async e=>{e.preventDefault(),p(!0);try{const e=a,{response:t,transaction:n}=await(0,h.fetchServicesImage)({...e,prompt:e.image_prompt,consumer_module:"playground",image_source:e.image_source,image_model:"pexels"===e.image_source?"pexels":"dall-e-3"});if(p(!1),n&&i(n),!t)return;(e=>{s({images:e})})(t)}catch(e){r(e)}},isDisabled:!a.image_prompt},f.length>0&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{className:"aicp__playground__modal__image__button-container"},(0,e.createElement)("button",{onClick:async e=>{e.preventDefault();const{caption:t="",base64:n=""}=a.images.find((e=>e.src===c)),l={url:c,caption:t,base64:n,post_id:0};v(!0),await(0,h.fetchRestApiImageUpload)({data:l}),v(!1)},className:"button button-secondary",disabled:y},(0,l.__)("Save to Media Library","ai-copilot")),y&&(0,e.createElement)(n.Spinner,null)))))},N=()=>{const{playgroundTab:t}=o();return(0,e.createElement)(e.Fragment,null,"completion"===t&&(0,e.createElement)(C,null),"chat"===t&&(0,e.createElement)(b,null),"assistant"===t&&(0,e.createElement)(v,null),"image"===t&&(0,e.createElement)(A,null))},x=()=>{const{isModalOpen:t,setIsModalOpen:a,playgroundTab:l}=o();return(0,e.createElement)(n.Modal,{className:_()("aicp__playground__modal",l),show:t,onClose:()=>a(!1)},(0,e.createElement)(N,null))},T=()=>{const{savedSettingsModules:t}=(0,c.useAdminMenuModulesSettings)(),a=t.playground_enable,{isModalOpen:n,setIsModalOpen:l}=o();return(0,e.useEffect)((()=>{if(void 0===a)return;const e=document.querySelector("#wp-admin-bar-wcp_playground_admin_bar_link");return e&&e.addEventListener("click",(e=>{e.preventDefault(),l(!0)})),0===a?(e?.classList.add("hidden"),l(!1)):e.classList.contains("hidden")&&(1===e.classList.length?e.removeAttribute("class"):e.classList.remove("hidden")),()=>{e?.removeEventListener("click",(()=>l(!0)))}}),[a,l]),n?(0,e.createElement)(x,null):null};(0,t.onDocumentLoaded)((()=>{const t=document.getElementById("wpadminbar"),a=document.createElement("div");t.appendChild(a),(0,e.render)((0,e.createElement)(i,null,(0,e.createElement)(n.TransactionsFormProvider,null,(0,e.createElement)(T,null))),a)}))})()})();