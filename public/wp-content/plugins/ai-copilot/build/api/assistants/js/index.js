(()=>{"use strict";var s={d:(t,e)=>{for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},o:(s,t)=>Object.prototype.hasOwnProperty.call(s,t),r:s=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})}},t={};s.r(t),s.d(t,{INITIAL_STATE:()=>o,QUADLAYERS_AICP_STORE_NAME:()=>R,STORE_NAME:()=>r,actions:()=>a,fetchRestApiAssistantFiles:()=>S,fetchRestApiAssistants:()=>u,fetchRestApiAssistantsSync:()=>y,reducer:()=>n,resolvers:()=>i,selectors:()=>e,useApiAssistant:()=>g});var e={};s.r(e),s.d(e,{getAssistants:()=>d});var a={};s.r(a),s.d(a,{createAssistant:()=>f,deleteAssistant:()=>T,editAssistant:()=>b,setAssistants:()=>_,syncAssistants:()=>m});var i={};s.r(i),s.d(i,{getAssistants:()=>w});var n={};s.r(n),s.d(n,{default:()=>v});const c=window.wp.data,r="aicp/assistants/store",o={assinstants:[]},d=s=>s.assistants,p=window.wp.i18n,A=window.wp.notices,l=window.aicp.helpers,{QUADLAYERS_AICP_API_ASSISTANTS_REST_ROUTES:h}=aicpApiAssistants,u=({method:s,data:t}={})=>(0,l.apiFetch)({path:h.assistants,method:s,data:t}),y=({method:s,data:t}={})=>(0,l.apiFetch)({path:h.assistants+"?sync=true",method:s,data:t}),S=({method:s,data:t,post_type_id:e=null}={})=>{const a=`${h.assistant_file}?post_type_id=${e}`;return(0,l.apiFetch)({path:a,method:s,data:t})};function g(){const{createAssistant:s,editAssistant:t,deleteAssistant:e,syncAssistants:a}=(0,c.useDispatch)(r),{assistants:i,isResolvingAssistants:n,hasResolvedAssistants:o}=(0,c.useSelect)((s=>{const{isResolving:t,hasFinishedResolution:e,getAssistants:a}=s(r);let i=s("core/editor").getEditedPostAttribute("type");if(!i){const s=document.getElementById("post_type");s&&(i=s.value)}return{assistants:a()||[],isResolvingAssistants:t("getAssistants"),hasResolvedAssistants:e("getAssistants")}}),[]);return{assistants:i,isResolvingAssistants:n,hasResolvedAssistants:o,hasAssistants:!(!o||!i?.length),createAssistant:s,editAssistant:t,deleteAssistant:e,syncAssistants:a}}const _=s=>({type:"SET_ASSISTANTS",payload:s}),f=s=>async({registry:t,dispatch:e,select:a})=>{const i=await u({method:"POST",data:s});if(i?.code||i?.message)return t.dispatch(A.store).createSuccessNotice((0,p.sprintf)("%s: %s",i.code,i.message),{type:"snackbar"}),!1;const n=a.getAssistants();return n.push(i),e.setAssistants([...n]),t.dispatch(A.store).createSuccessNotice((0,p.__)("The assistant has been created successfully.","ai-copilot"),{type:"snackbar"}),i},m=()=>async({registry:s,dispatch:t,select:e})=>{const a=await y({method:"GET"});return a?.code||a?.message?(s.dispatch(A.store).createSuccessNotice((0,p.sprintf)("%s: %s",a.code,a.message),{type:"snackbar"}),!1):(t.setAssistants([...a]),s.dispatch(A.store).createSuccessNotice((0,p.__)("The assistants have been synchronized successfully.","ai-copilot"),{type:"snackbar"}),a)},T=s=>async({registry:t,dispatch:e,select:a})=>{const i=a.getAssistants(),n=await u({method:"DELETE",data:{assistant_id:s}});if(n?.code||n?.message)return t.dispatch(A.store).createSuccessNotice((0,p.sprintf)("%s: %s",n.code,n.message),{type:"snackbar"}),!1;const c=i.filter((t=>parseInt(t.assistant_id)!==parseInt(s)));return e.setAssistants([...c]),t.dispatch(A.store).createSuccessNotice((0,p.sprintf)((0,p.__)("The assistant %s has been deleted.","ai-copilot"),s),{type:"snackbar"}),!0},b=s=>async({registry:t,dispatch:e,select:a})=>{const i=await u({method:"PATCH",data:s});if(i?.code||i?.message)return t.dispatch(A.store).createSuccessNotice((0,p.sprintf)("%s: %s",i.code,i.message),{type:"snackbar"}),!1;const n=a.getAssistants();return e.setAssistants([...n.map((t=>t.assistant_id==s.assistant_id?i:t))]),t.dispatch(A.store).createSuccessNotice((0,p.__)("The assistant has been updated successfully.","ai-copilot"),{type:"snackbar"}),!0},w=async()=>{try{const s=await u({method:"GET"});return _(s)}catch(s){console.error(s)}};function v(s=o,t){return"SET_ASSISTANTS"===t.type?{...s,assistants:t.payload}:s}const E=(0,c.createReduxStore)(r,{reducer:v,actions:a,selectors:e,resolvers:i});(0,c.register)(E);const R=r;(window.aicp=window.aicp||{})["api-assistants"]=t})();