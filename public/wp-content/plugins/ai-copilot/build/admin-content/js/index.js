/*! For license information please see index.js.LICENSE.txt */
(()=>{var e={500:(e,t)=>{var n;!function(){"use strict";var a={}.hasOwnProperty;function o(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=l(e,i(n)))}return e}function i(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return o.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)a.call(e,n)&&e[n]&&(t=l(t,n));return t}function l(e,t){return t?e?e+" "+t:e+t:e}e.exports?(o.default=o,e.exports=o):void 0===(n=function(){return o}.apply(t,[]))||(e.exports=n)}()}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=window.wp.element,t=window.aicp.helpers,a=window.wp.i18n,o=window.aicp.components;function i({}){return(0,e.createElement)(o.ItemTooltip,null,(0,e.createElement)("h3",null,(0,a.__)("Content","ai-copilot")),(0,e.createElement)("p",null,(0,a.__)("This module enables you to create or review content for any post type. Upon activation, a new metabox appears in the post editor interface.","ai-copilot")),(0,e.createElement)("hr",null),(0,e.createElement)(o.ItemTip,null,(0,e.createElement)("b",null,(0,a.__)("Create: ","ai-copilot")),(0,a.__)("This panel found in new posts, assists you in generating content on a chosen topic.","ai-copilot")),(0,e.createElement)(o.ItemTip,null,(0,e.createElement)("b",null,(0,a.__)("Review: ","ai-copilot")),(0,a.__)("This panel found in posts with existing content, helping you to review and enhance the material.","ai-copilot")),(0,e.createElement)("hr",null),(0,e.createElement)("p",null,(0,e.createInterpolateElement)((0,a.__)("For more information, please check the documentation <a>here</a>.","ai-copilot"),{a:(0,e.createElement)("a",{href:t.QUADLAYERS_AICP_DOCUMENTATION_URL,target:"_blank",rel:"noreferrer"})})))}function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},l.apply(this,arguments)}const r=window.aicp.icons,s=({onClick:t})=>(0,e.createElement)("div",{className:"aicp__flex",style:{gap:0}},(0,e.createElement)("button",{className:"aicp__editor-button button button-primary",onClick:e=>{e.preventDefault(),t()}},(0,e.createElement)(r.Copilot,null),(0,a.__)("AI Panel","ai-copilot")),(0,e.createElement)(i,null)),c=n=>{const[i,r]=(0,e.useState)(!1);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("p",null,(0,a.__)("Unlock the potential of AI-enhanced content creation with our AI Panel.","ai-copilot")),(0,e.createElement)("hr",null),(0,e.createElement)(s,{onClick:()=>r(!0)}),(0,e.createElement)(o.AIPanel,l({},n,{isModalOpen:i,onClose:()=>r(!1)})),(0,e.createElement)("hr",null),(0,e.createElement)(o.ItemTip,null,(0,e.createInterpolateElement)((0,a.__)("For more information, please check the documentation <a>here</a>.","ai-copilot"),{a:(0,e.createElement)("a",{href:t.QUADLAYERS_AICP_DOCUMENTATION_URL,target:"_blank",rel:"noreferrer"})})))},p=window.aicp.hooks,m=window.aicp["api-services"],_=window.wp.components;var d=n(500),u=n.n(d);const g=({shift:t=!0,offset:n=5,initialOpen:a=!1,preventClose:o=!1,disabled:i,text:l="",displayDefaultPopoverContainer:s=!0,hideIcon:c=!1,children:p,className:m,position:d="middle right",placement:g,noArrow:E=!1})=>{const[h,f]=(0,e.useState)(a),b=()=>{o||f(!1)};return(0,e.createElement)("div",{className:u()("aicp__components__tooltip",m,i&&"aicp__components__tooltip--disabled")},(0,e.createElement)("div",{className:"aicp__components__tooltip__button",onMouseEnter:()=>{i||f(!0)}},!!l&&(0,e.createElement)("span",{className:"aicp__components__tooltip__button__text"},l),!c&&(0,e.createElement)(r.Ask,null)),h&&(0,e.createElement)(_.Popover,{shift:t,offset:n,noArrow:E,position:g?void 0:d,placement:g||void 0,focusOnMount:"false",className:u()("aicp__components__tooltip__popover",m&&m+"__popover"),onClose:b,onMouseLeave:b},s?(0,e.createElement)("div",null,p):p))};function E({label:t,help:n,className:a=""}){return(0,e.createElement)("span",{className:u()("aicp__components__label",a)},t,n&&(0,e.createElement)(g,null,(0,e.createElement)("p",null,n)))}function h(t){const{name:n,values:o,onChange:i}=t;return(0,e.createElement)(_.TextareaControl,{label:(0,e.createElement)(E,{label:(0,a.__)("Topic:","ai-copilot"),help:(0,a.__)("Specify the main topic and guidelines for creating the content.","ai-copilot")}),placeholder:(0,a.__)("Please indicate the topic.","ai-copilot"),value:o?.topic,onChange:e=>i(n,e),help:!o?.topic&&(0,a.__)("Topic is required.","ai-copilot"),className:!o?.topic&&"aicp__field--required"})}function f({fields:n,values:o,onChange:i,isTopicRequired:l,sectionCountisVisible:r=!0,paragraphCountisVisible:s=!0,wordCountisVisible:c=!0,setCurrentInstanceFields:p}){const{variables_language:d=t.WP_LANGUAGE_NAME,variables_style:u,variables_tone:g,variables_section_count:f,variables_paragraph_count:b,variables_word_count:v,model:C}=o,[T,N]=(0,e.useState)(!1),I=e=>t=>i({...o,[e]:t});return(0,e.useEffect)((()=>{const{maxTokens:e}=m.OPENAI_MODELS.find((e=>e.model===C)),a=(0,t.isTokenLimitExceeded)({content:n?.content,wordCount:v,maxTokens:e});N(a)}),[C,v]),(0,e.createElement)(e.Fragment,null,l&&(0,e.createElement)(h,{name:"topic",values:n,onChange:(e,t)=>{p({[e]:t})}}),r&&(0,e.createElement)(_.RangeControl,{label:(0,a.__)("Number of Sections:","ai-copilot"),value:f,onChange:I("variables_section_count"),min:1,max:10,disabled:!(0,t.isUsedReplacement)(o,"SECTIONS_COUNT"),help:!(0,t.isUsedReplacement)(o,"SECTIONS_COUNT")&&(0,a.__)("To allow this setting include {SECTIONS_COUNT} in your prompts.","ai-copilot")}),s&&(0,e.createElement)(_.RangeControl,{label:(0,a.__)("Number of Paragraphs per Section:","ai-copilot"),value:b,onChange:I("variables_paragraph_count"),min:1,max:10,disabled:!(0,t.isUsedReplacement)(o,"PARAGRAPHS_PER_SECTION"),help:!(0,t.isUsedReplacement)(o,"PARAGRAPHS_PER_SECTION")&&(0,a.__)("To allow this setting include {PARAGRAPHS_PER_SECTION} in your prompts.","ai-copilot")}),c&&(0,e.createElement)(_.RangeControl,{label:(0,a.__)("Number of Words:","ai-copilot"),value:v,onChange:I("variables_word_count"),min:1,max:1e4,disabled:!(0,t.isUsedReplacement)(o,"WORD_LENGTH"),help:!(0,t.isUsedReplacement)(o,"WORD_LENGTH")&&(0,a.__)("To allow this setting include {WORD_LENGTH} in your prompts.","ai-copilot")||T&&(0,a.__)("The number of words exceeds the maximum tokens of the model","ai-copilot"),className:T&&"aicp__field--required"}),(0,e.createElement)(_.SelectControl,{label:(0,a.__)("Language:","ai-copilot"),value:d,options:t.OPTIONS_LANGUAGE,onChange:I("variables_language"),disabled:!(0,t.isUsedReplacement)(o,"LANGUAGE"),help:!(0,t.isUsedReplacement)(o,"LANGUAGE")&&(0,a.__)("To allow this setting include {LANGUAGE} in your prompts.","ai-copilot")}),(0,e.createElement)(_.SelectControl,{label:(0,e.createElement)(E,{label:(0,a.__)("Style:","ai-copilot"),help:(0,a.__)("Select the trait for the response. For instance, if you're seeking for convincing response, choose the 'argumtentative' option. ","ai-copilot\t")}),value:u,options:t.OPTIONS_TEXT_STYLE,onChange:I("variables_style"),disabled:!(0,t.isUsedReplacement)(o,"WRITING_STYLE"),help:!(0,t.isUsedReplacement)(o,"WRITING_STYLE")&&(0,a.__)("To allow this setting include {WRITING_STYLE} in your prompts.","ai-copilot")}),(0,e.createElement)(_.SelectControl,{label:(0,e.createElement)(E,{label:(0,a.__)("Tone:","ai-copilot"),help:(0,a.__)("Select the desired expression for the response. For instance, if you're seeking for a serious response, choose the 'professional' option. ","ai-copilot\t")}),value:g,options:t.OPTIONS_TEXT_TONE,onChange:I("variables_tone"),disabled:!(0,t.isUsedReplacement)(o,"WRITING_TONE"),help:!(0,t.isUsedReplacement)(o,"WRITING_TONE")&&(0,a.__)("To allow this setting include {WRITING_TONE} in your prompts.","ai-copilot")}))}function b(n){const{values:o,onChange:i,fields:l,allowPreview:r=!1}=n,[s,c]=(0,e.useState)(r),{prompt_system:p,prompt_title:m,prompt_sections:d,prompt_content:u,prompt_excerpt:g,prompt_tags:E,variables_language:h,variables_style:f,variables_tone:b,variables_section_count:v,variables_paragraph_count:C,variables_word_count:T}=o,N={TOPIC:l.topic,TITLE:l.title,SECTIONS:l.sections,CONTENT:l.content,EXCERPT:l.excerpt,TAGS:l.tags,SECTIONS_COUNT:v,PARAGRAPHS_PER_SECTION:C,WORD_LENGTH:T,LANGUAGE:h,WRITING_STYLE:f,WRITING_TONE:b},I=e=>t=>{i({...o,[e]:t})};return(0,e.createElement)(e.Fragment,null,r&&(0,e.createElement)(_.ToggleControl,{label:(0,a.__)("Preview","ai-copilot"),help:(0,a.__)("Display the resulting prompt, with all variables replaced.","ai-copilot"),checked:s,onChange:c}),(0,e.createElement)(_.TextareaControl,{label:(0,a.__)("Prompt System:","ai-copilot"),help:!p&&(0,a.__)("Prompt is required","ai-copilot"),className:!p&&"aicp__field--required",value:p,disabled:s,onChange:I("prompt_system")}),(0,e.createElement)(_.TextareaControl,{label:(0,a.__)("Prompt Title:","ai-copilot"),help:!m&&(0,a.__)("Prompt is required","ai-copilot"),className:!m&&"aicp__field--required",value:s?(0,t.generatePrompt)(m,N):m,disabled:s,onChange:I("prompt_title")}),(0,e.createElement)(_.TextareaControl,{label:(0,a.__)("Prompt Sections:","ai-copilot"),help:!d&&(0,a.__)("Prompt is required","ai-copilot"),className:!d&&"aicp__field--required",value:s?(0,t.generatePrompt)(d,N):d,disabled:s,onChange:I("prompt_sections")}),(0,e.createElement)(_.TextareaControl,{label:(0,a.__)("Prompt Content:","ai-copilot"),help:!u&&(0,a.__)("Prompt is required","ai-copilot"),className:!u&&"aicp__field--required",value:s?(0,t.generatePrompt)(u,N):u,disabled:s,onChange:I("prompt_content")}),(0,e.createElement)(_.TextareaControl,{label:(0,a.__)("Prompt Excerpt:","ai-copilot"),help:!g&&(0,a.__)("Prompt is required","ai-copilot"),className:!g&&"aicp__field--required",value:s?(0,t.generatePrompt)(g,N):g,disabled:s,onChange:I("prompt_excerpt")}),(0,e.createElement)(_.TextareaControl,{label:(0,a.__)("Prompt Tags:","ai-copilot"),help:!E&&(0,a.__)("Prompt is required","ai-copilot"),className:!E&&"aicp__field--required",value:s?(0,t.generatePrompt)(E,N):E,disabled:s,onChange:I("prompt_tags")}))}function v({children:t,disabled:n=!1,error:a=!1}){return(0,e.createElement)("div",{className:u()("aicp__item-response",a&&"aicp__field--required")},(0,e.createElement)(_.Disabled,{isDisabled:n},t))}function C({className:t,hideText:n=!1}){return(0,e.createElement)("div",{className:u()("aicp__components__spinner",t)},(0,e.createElement)("span",{style:{visibility:"visible"},className:"spinner"}),!n&&(0,a.__)("Loading…","ai-copilot"))}function T(t){const{value:n,label:o,loading:i,error:l,onWriteField:r,onFetchField:s}=t;return(0,e.createElement)(e.Fragment,null,o,i&&(0,e.createElement)("div",{className:"aicp__item-response__label__spinner"},(0,e.createElement)(C,null)),(0,e.createElement)("div",null,!i&&!!s&&(0,e.createElement)("a",{href:"#",className:"aicp__item-response__label__button",onClick:e=>{e.preventDefault(),s()}},(0,a.__)("Create","ai-copilot")),!i&&!l&&!!r&&!!n&&(0,e.createElement)("a",{href:"#",className:"aicp__item-response__label__button",onClick:e=>{e.preventDefault(),r()}},(0,a.__)("Write","ai-copilot"))))}function N(t){const{help:n,value:a,name:o,onChange:i,disabled:l}=t;return(0,e.createElement)(v,t,(0,e.createElement)(_.TextControl,{label:(0,e.createElement)(T,t),help:n,value:a,disabled:l,onChange:e=>i(o,e)}))}function I(t){const{help:n,value:a,name:o,rows:i=4,onChange:l,disabled:r}=t;return(0,e.createElement)(v,t,(0,e.createElement)(_.TextareaControl,{label:(0,e.createElement)(T,t),rows:i,help:n,value:a,disabled:r,onChange:e=>l(o,e)}))}function w({images:t,onChange:n=(()=>{})}){const[a,o]=(0,e.useState)(0),[i,l]=(0,e.useState)(!1),s=(0,e.useRef)(null),c=e=>a=>{a.preventDefault(),o(e),n(t[e])},p=()=>{s.current&&!s.current.complete&&(s.current.style.display="none",l(!0),s.current.onload=()=>{s.current&&(s.current.style.display="block"),l(!1)})};return(0,e.useEffect)((()=>{o(0),p(),t.length>0&&n(t[0])}),[JSON.stringify(t)]),(0,e.useEffect)((()=>{p()}),[a]),(0,e.createElement)("div",{className:"aicp__carousel-images"},t?.length?(0,e.createElement)(e.Fragment,null,i&&(0,e.createElement)(C,{hideText:!0}),(0,e.createElement)("img",{ref:s,className:"aicp__carousel-images__image",src:t[a]}),(0,e.createElement)("div",{className:"aicp__carousel-images__controls-container"},(0,e.createElement)("span",{className:`dashicons dashicons-arrow-left aicp__carousel-images__control-left ${0===a&&"aicp__carousel-images__control-left--disabled"}`,onClick:c(a-1)}),(0,e.createElement)("span",null,`${a+1}/${t.length}`),(0,e.createElement)("span",{className:`dashicons dashicons-arrow-right aicp__carousel-images__control-right ${a===t.length-1&&"aicp__carousel-images__control-right--disabled"}`,onClick:c(a+1)}))):(0,e.createElement)("div",{className:"aicp__carousel-images__image"},(0,e.createElement)(r.ImagePlaceholder,null)))}function y(t){const{name:n,images:a,onChange:o}=t;return(0,e.createElement)(v,t,(0,e.createElement)(_.BaseControl,{id:"image_field",label:(0,e.createElement)(T,t)},(0,e.createElement)(w,{images:a,onChange:e=>o(n,e)})))}function S({values:n,onChange:o,onWriteTitle:i,onWriteContent:l,onWriteExcerpt:r,onWriteTags:s,onWriteImage:c,onFetchFieldTitle:p,onFetchFieldSections:m,onFetchFieldContent:_,onFetchFieldExcerpt:d,onFetchFieldTags:u,onFetchFieldImages:g,allowWrite:E=!0}){const f=n.isTitleLoading||n.isContentLoading||n.isExcerptLoading||n.isTagsLoading||n.isSectionsLoading||n.isImagesLoading,b=(0,t.isUsedReplacement)(n,"TOPIC");return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{className:"aicp__modal__flex"},b&&(0,e.createElement)("div",{className:"aicp__modal__flex__column0"},(0,e.createElement)(h,{name:"topic",values:n,onChange:o})),(0,e.createElement)("div",{className:"aicp__modal__flex__column2"},(0,e.createElement)(N,{label:(0,a.__)("Title","ai-copilot"),value:n.title,name:"title",error:n.isTitleError,disabled:f,loading:n.isTitleLoading,onWriteField:E&&(()=>i(n.title)),onChange:o,onFetchField:p}),(0,e.createElement)(I,{label:(0,a.__)("Sections","ai-copilot"),value:n.sections,name:"sections",error:n.isSectionsError,disabled:f,loading:n.isSectionsLoading,onChange:o,onFetchField:m}),(0,e.createElement)(I,{rows:12,label:(0,a.__)("Content","ai-copilot"),value:n.content,name:"content",error:n.isContentError,disabled:f,loading:n.isContentLoading,onWriteField:E&&(()=>l(n.content)),onChange:o,onFetchField:_})),(0,e.createElement)("div",{className:"aicp__modal__flex__column1"},(0,e.createElement)(I,{label:(0,a.__)("Excerpt","ai-copilot"),value:n.excerpt,name:"excerpt",error:n.isExcerptError,disabled:f,loading:n.isExcerptLoading,onWriteField:E&&(()=>r(n.excerpt)),onChange:o,onFetchField:d}),(0,e.createElement)(N,{label:(0,a.__)("Tags","ai-copilot"),value:n.tags,name:"tags",error:n.isTagsError,disabled:f,loading:n.isTagsLoading,onWriteField:E&&(()=>s(n.tags)),onChange:o,onFetchField:u}),(0,e.createElement)(y,{label:(0,a.__)("Image","ai-copilot"),value:n.images.find((e=>e.isFeatured))?.src,images:n.images.map((e=>e.src)),name:"image",error:n.isImagesError,disabled:f,loading:n.isImagesLoading,onWriteField:E&&(()=>{const{src:e,caption:t="",base64:a=""}=n.images.find((e=>e.isFeatured));c(e,n.image_position,t,a)}),onChange:o,onFetchField:g}))))}const P=[{label:(0,a.__)("Variables","ai-copilot"),name:"variables",component:n=>{const{panel:o}=n,{instances:i,selectedInstanceId:l,setCurrentInstanceFields:r,setCurrentInstanceSettings:s}=o,{settings:c,fields:p}=i[l],m=(0,t.isUsedReplacement)(c,"TOPIC");return(0,e.createElement)("div",{className:"aicp__modal__flex"},(0,e.createElement)("div",{className:"aicp__modal__flex__column0"},(0,e.createElement)("h2",null,(0,a.__)("Setup generation prompts variables","ai-copilot")),(0,e.createElement)(f,{isTopicRequired:m,fields:p,values:c,setCurrentInstanceFields:r,onChange:s})))},validate:(e,n,a)=>!!((e.topic||!(0,t.isUsedReplacement)(n,"TOPIC"))&&n.prompt_content&&n.prompt_excerpt&&n.prompt_sections&&n.prompt_tags&&n.prompt_title&&n.prompt_system)},{label:(0,a.__)("Preview","ai-copilot"),name:"preview",component:t=>{const{panel:n}=t,{setCurrentInstanceSettings:o,selectedInstanceId:i,instances:l}=n,{post:r,fields:s,images:c,settings:p}=l[i];return(0,e.createElement)("div",{className:"aicp__modal__flex"},(0,e.createElement)("div",{className:"aicp__modal__flex__column0"},(0,e.createElement)("h2",null,(0,a.__)("Preview generation prompts","ai-copilot")),(0,e.createElement)(b,{allowPreview:!0,fields:s,values:p,onChange:o})))}},{label:(0,a.__)("Response","ai-copilot"),name:"response",component:t=>{const{panel:n}=t,{instances:a,selectedInstanceId:o,setCurrentInstanceFields:i,setCurrentInstanceImages:r,multiple:s}=n,{post:c,fields:p,images:m,settings:_}=a[o];return(0,e.createElement)(S,l({values:{...p,..._,images:m},onChange:(e,t)=>{if("image"===e){const e=m.map((e=>({...e,isFeatured:e.src===t})));r(e)}else i({[e]:t})},allowWrite:!s},t))}}],x=(e,t)=>{const n=window.tinymce.get(e),a=document.getElementById(e);n?n.setContent(t):a&&(a.value=t)},R=(O=c,n=>{const i=document.getElementById("post_type")?.value,{post:r,hasResolvedPost:s}=(0,p.usePost)((0,t.getCurrentPostId)(),i),c=e=>{document.getElementById("title").value=e},_=e=>{x("content",e)},d=e=>{x("excerpt",e)},u=e=>{document.getElementById("new-tag-product_tag").value=e},g=async(e,n,o="",i="")=>{if(!e)return;const l=tinymce.get("content");l.setMode("readonly");const s=(0,a.__)("Loading Image…","ai-copilot"),c=sprintf('<p id="aicp-loading-image">%s</p>',s),p=l.getContent();l.setContent(c+p);const _=l.dom.select('p[id="aicp-loading-image"]')[0],d={url:e,post_id:r?.id||0,caption:o,base64:i},{image_id:u,image_url:g}=await(0,m.fetchRestApiImageUpload)({data:d});let E;E=o?(0,t.getCaptionImageHTML)({image_id:u,image_url:g,position:n,caption:o}):`<img src="${g}" class="align${n}" />`,l.selection.select(_),l.selection.setContent(E),l.setMode("design"),wp.media.featuredImage.set(u)},E=()=>{if(!s)return[];let e="";const t=[];if(document.querySelector("#postimagediv img"))e=document.querySelector("#postimagediv img").src;else{const t=tinymce.get("content").getContent(),n=document.createElement("div");n.innerHTML=t;const a=n.querySelector("img");a&&(e=a.src)}return e&&t.unshift({src:e}),t},h=(0,e.useMemo)((()=>{const e=r?.id||0;return{[e]:{post:{postId:e,postType:i},images:E(),fields:{title:r?.title||"",content:r?.content||"",excerpt:r?.excerpt||"",tags:r?.tagNames?.join(",")||"",sections:(0,t.getPostTypeContentSections)(r?.content)?.join("\n\n")||""}}}}),[r]),f={steps:P,instances:h,onWriteTitle:c,onWriteContent:_,onWriteExcerpt:d,onWriteTags:u,onWriteImage:g,onWriteAll:e=>{for(const t in e){const{fields:n,images:a,settings:o}=e[t],{src:i,caption:l="",base64:r=""}=a.find((e=>e.isFeatured));c(n.title),_(n.content),d(n.excerpt),u(n.tags),g(i,o.image_position,l,r)}}};return s?(0,e.createElement)(O,l({},n,f)):(0,e.createElement)(o.Spinner,null)});var O;(0,t.onDocumentLoaded)((()=>{const t=document.getElementById("ai-copilot-metabox"),n=document.getElementById("ai-copilot-metadata");if(t&&(0,e.render)((0,e.createElement)(R,null),t),n){const t=n.querySelector(".postbox-header").querySelector("h2"),a=document.createElement("span");a.style.setProperty("margin-left","auto","important"),t.appendChild(a),(0,e.render)((0,e.createElement)(i,null),a)}}));const F=window.wp.plugins,A=window.wp.editPost,L=window.wp.data,W=window.wp.blocks,U=window.wp.blockEditor,k=n=>i=>{const{post:r,setPost:s}=(0,p.useCurrentPost)(),{setTaxonomyTerms:c}=(0,p.useCurrentPostTaxonomies)(),{insertBlocks:_,removeBlocks:d}=(0,L.useDispatch)(U.store),u=e=>t=>s(e,t),g=async(e,t,n="",o="")=>{if(!e)return;const i={url:e,base64:o,post_id:r?.id||0,caption:n},l=(0,W.createBlock)("core/paragraph",{content:(0,a.__)("Loading Image…","ai-copilot")});_(l,0);const{image_id:c,image_url:p}=await(0,m.fetchRestApiImageUpload)({data:i}),u=(0,W.createBlock)("core/image",{url:p,caption:n,align:t});_(u,0),d(l.clientId),s("featured_media",c)},E=e=>{const t=e.split(",").map((e=>e.trim().toLowerCase())),n=[...new Set(t)];c("post_tag",n)},h=()=>{let e="";const t=[];if(r?.featured_image_url)e=r?.featured_image_url;else{const t=r?.blocks?.find((e=>"core/image"===e.name));t&&(e=t.attributes.url)}return e&&t.unshift({src:e}),t},f=(0,e.useMemo)((()=>{const e=r?.id||0,n=r?.type;return{[e]:{post:{postId:e,postType:n},images:h(),fields:{title:r?.title||"",content:r?.content||"",excerpt:r?.excerpt||"",tags:r?.tagNames?.join(",")||"",sections:(0,t.getPostTypeContentSections)(r?.content)?.join("\n\n")||""}}}}),[r]);if(!r)return(0,e.createElement)(o.Spinner,null);const b={steps:P,instances:f,onWriteTitle:u("title"),onWriteContent:u("content"),onWriteExcerpt:u("excerpt"),onWriteTags:E,onWriteImage:g,onWriteAll:e=>{for(const t in e){const{fields:n,images:a,settings:o}=e[t],{src:i,caption:l="",base64:r=""}=a.find((e=>e.isFeatured));s("title",n.title),s("content",n.content),s("excerpt",n.excerpt),E(n.tags),g(i,o.image_position,l,r)}}};return(0,e.createElement)(n,l({},i,b))},G=k(c),q=k((t=>{const[n,a]=(0,e.useState)(!1);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(s,{onClick:()=>a(!0)}),(0,e.createElement)(o.AIPanel,l({},t,{isModalOpen:n,onClose:()=>a(!1)})))}));(0,F.registerPlugin)("aicp-sidebar",{render:()=>(0,e.createElement)(A.PluginDocumentSettingPanel,{name:"ai-copilot",title:(0,e.createElement)(e.Fragment,null,(0,e.createElement)("span",null,(0,a.__)("AI Copilot","ai-copilot")),(0,e.createElement)("span",{className:"dashicon dashicons dashicons-admin-tools components-panel__icon"}),(0,e.createElement)("span",{style:{marginLeft:"auto"}},(0,e.createElement)(i,null))),initialOpen:!1},(0,e.createElement)(_.Panel,null,(0,e.createElement)(G,null)))}),(0,t.onDocumentLoaded)((()=>{setTimeout((()=>{const t=document.querySelector(".edit-post-header__toolbar");if(t){const n=document.createElement("div");t.insertBefore(n,t.lastElementChild),(0,e.render)((0,e.createElement)(q,null),n)}}),1e3)}))})()})();